define("tiny_qrcode/qrcodemodal",["exports","core/modal","./common","core/ajax"],(function(_exports,_modal,_common,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal=_interopRequireDefault(_modal),_ajax=_interopRequireDefault(_ajax);class QrcodeModal extends _modal.default{registerEventListeners(){const attachSubmitHandler=()=>{const qrcodeForm=window.document.getElementById("qrcode-submit"),closebtn=window.document.querySelector("div.modal div.modal-content div.modal-header button.btn-close");closebtn&&closebtn.addEventListener("click",(event=>{this.destroy()})),qrcodeForm?qrcodeForm.dataset.listenerAttached||(qrcodeForm.addEventListener("click",(event=>{event.preventDefault();const contentInput=window.document.querySelector("#qrcodecontent");if(""!==contentInput.value.trim()){var _document$querySelect,_document$querySelect2;const hexToRgba=function(hex){let alpha=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;hex=hex.replace(/^#/,"");const bigint=parseInt(hex,16),r=bigint>>16&255,g=bigint>>8&255,b=255&bigint;return{r:r,g:g,b:b,a:alpha}},formData={content:document.querySelector("#qrcodecontent").value,size:parseInt(document.querySelector("#qrcode_size").value),margin:parseInt(document.querySelector("#qrcode_margin").value),bgColor:hexToRgba(document.querySelector("#bgtemplateColor").value,parseFloat((null===(_document$querySelect=document.querySelector("#bgcolor_a"))||void 0===_document$querySelect?void 0:_document$querySelect.value)||1)),fgColor:hexToRgba(document.querySelector("#templateColor").value,parseFloat((null===(_document$querySelect2=document.querySelector("#color_a"))||void 0===_document$querySelect2?void 0:_document$querySelect2.value)||1))};_ajax.default.call([{methodname:"tiny_qrcode_generate_qr_code",args:{data:JSON.stringify({content:formData.content,size:formData.size,margin:formData.margin,bgColor:formData.bgColor,fgColor:formData.fgColor})},done:function(response){if(response.status){const targetEditor=window.currentQRCodeEditor;targetEditor?targetEditor.insertContent('<img src="'.concat(response.datauri,'" alt="QR Code for ').concat(formData.content,'" />')):console.error("No target editor found")}else console.error("QR Code generation failed");window.currentQRCodeEditor=null},fail:function(ex){console.error("Web service call failed",ex),window.currentQRCodeEditor=null}}]),this.destroy()}else contentInput.style.border="2px solid red"})),qrcodeForm.dataset.listenerAttached=!0):(console.warn("Form not found. Retrying..."),setTimeout(attachSubmitHandler,500))};attachSubmitHandler()}configure(modalConfig){modalConfig.show=!0,super.configure(modalConfig)}}return _exports.default=QrcodeModal,_defineProperty(QrcodeModal,"TYPE","".concat(_common.component,"/qrcodemodal")),_defineProperty(QrcodeModal,"TEMPLATE","".concat(_common.component,"/insert_qrcode_modal")),_exports.default}));

//# sourceMappingURL=qrcodemodal.min.js.map